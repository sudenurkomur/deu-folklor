{"version":3,"file":"Provider.js","names":["_react","require","_server","_constants","_utils","_client","_jsxRuntime","Context","exports","createContext","undefined","HelmetProvider","children","context","current","heap","useRef","firstRender","helmets","state","contextValueRef","clientApply","IS_DOM_ENVIRONMENT","calcAggregatedState","defer","nextAnimFrameId","requestAnimationFrame","commitTagChanges","cancelAnimationFrame","update","id","props","idx","findIndex","item","splice","push","helmet","serverState","newServerState","jsx","value","_default","default"],"sources":["../../src/Provider.tsx"],"sourcesContent":["import {\n  type FunctionComponent,\n  type ReactNode,\n  createContext,\n  useRef,\n} from 'react';\n\nimport type {\n  ContextValue,\n  HelmetDataContext,\n  HelmetProps,\n  HelmetProviderHeap,\n} from './types';\n\nimport { newServerState } from './server';\nimport { IS_DOM_ENVIRONMENT } from './constants';\nimport { calcAggregatedState } from './utils';\nimport { commitTagChanges } from './client';\n\nexport const Context = createContext<ContextValue | undefined>(undefined);\n\ntype ProviderProps = {\n  children?: ReactNode;\n  context?: HelmetDataContext;\n};\n\nconst HelmetProvider: FunctionComponent<ProviderProps> = ({\n  children,\n  context,\n}) => {\n  const { current: heap } = useRef<HelmetProviderHeap>({\n    firstRender: true,\n    helmets: [],\n    state: undefined,\n  });\n\n  const contextValueRef = useRef<ContextValue>(null);\n\n  contextValueRef.current ??= {\n    clientApply() {\n      if (IS_DOM_ENVIRONMENT && !heap.state) {\n        heap.state = calcAggregatedState(heap.helmets);\n        if (heap.state.defer) {\n          heap.nextAnimFrameId ??= requestAnimationFrame(() => {\n            heap.state ??= calcAggregatedState(heap.helmets);\n            commitTagChanges(heap.state, heap.firstRender);\n            heap.firstRender = false;\n            delete heap.nextAnimFrameId;\n          });\n        } else {\n          if (heap.nextAnimFrameId !== undefined) {\n            cancelAnimationFrame(heap.nextAnimFrameId);\n            delete heap.nextAnimFrameId;\n          }\n          commitTagChanges(heap.state, heap.firstRender);\n          heap.firstRender = false;\n        }\n      }\n    },\n    update(id: string, props: HelmetProps | undefined) {\n      const idx = heap.helmets.findIndex((item) => item[0] === id);\n      if (idx >= 0) {\n        delete heap.state;\n        if (props) heap.helmets[idx]![1] = props;\n        else heap.helmets.splice(idx, 1);\n      } else if (props) {\n        delete heap.state;\n        heap.helmets.push([id, props]);\n      }\n    },\n  };\n\n  if (context && (!context.helmet || context.helmet !== heap.serverState)) {\n    heap.serverState ??= newServerState(heap);\n\n    // eslint-disable-next-line no-param-reassign\n    context.helmet = heap.serverState;\n  }\n\n  return <Context value={contextValueRef.current}>{children}</Context>;\n};\n\nexport default HelmetProvider;\n"],"mappings":"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","ignoreList":[]}